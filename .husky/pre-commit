#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pre-commit hook for ArchTrack project
echo "ğŸ” Running pre-commit checks..."

# Check if we're in the right directory
if [ ! -f "package.json" ]; then
  echo "âŒ Error: package.json not found. Make sure you're in the project root."
  exit 1
fi

# Run TypeScript type checking
echo "ğŸ“ Running TypeScript type checking..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript type checking failed"
  exit 1
fi

# Run ESLint
echo "ğŸ”§ Running ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint failed"
  exit 1
fi

# Run Prettier check
echo "ğŸ’… Running Prettier check..."
npm run format:check
if [ $? -ne 0 ]; then
  echo "âŒ Prettier check failed"
  exit 1
fi

# Check for any usage
echo "ğŸš« Checking for 'any' usage..."
if grep -r ": any" apps/ --include="*.ts" --include="*.tsx" | grep -v "node_modules"; then
  echo "âŒ Found 'any' usage in TypeScript files"
  echo "Please replace 'any' with proper types"
  exit 1
fi

# Check for console.log statements (optional)
echo "ğŸ” Checking for console.log statements..."
if grep -r "console\.log" apps/ --include="*.ts" --include="*.tsx" | grep -v "node_modules" | grep -v "test"; then
  echo "âš ï¸  Warning: Found console.log statements"
  echo "Consider removing or replacing with proper logging"
fi

# Check for TODO comments
echo "ğŸ“‹ Checking for TODO comments..."
if grep -r "TODO:" apps/ --include="*.ts" --include="*.tsx" | grep -v "node_modules"; then
  echo "âš ï¸  Warning: Found TODO comments"
  echo "Consider addressing TODOs before committing"
fi

echo "âœ… All pre-commit checks passed!"
echo "ğŸš€ Ready to commit!"
